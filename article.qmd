---
title: "Classifying drug-induced webs using using Topological Data Analysis"
author:
  - name: Guilherme Vituri F. Pinto
    orcid: 0000-0002-7813-8777
    corresponding: true
    email: vituri.vituri@gmail.com
    roles:
      - Investigation
      - Project administration
      - Software
      - Visualization
    affiliations:
      - Unesp
  - name: Telmo
  - name: ??????
keywords:
  - Topological Data Analysis
  - Persistent homology
abstract: |
  We studied etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc  etc etc etc 
plain-language-summary: |
  Earthquake data for the island of La Palma from the September 2021 eruption is found ...
key-points:
  - A web scraping script was developed to pull data from the Instituto Geogràphico Nacional into a machine-readable form for analysis
  - Earthquake events on La Palma are consistent with the presence of both mantle and crustal reservoirs.
date: last-modified
bibliography: references.bib
citation:
  container-title: Earth and Space Science
number-sections: true

engine: julia
execute: 
  cache: true
  freeze: true
  output: docs/

---

# Analysis

## Loading the images

```{julia}
using TDAweb, TDAweb.Preprocessing, TDAweb.Analysis, TDAweb.TDA
using TidierFiles: list_files;
using DataFrames
using Images: mosaicview;
using Plots: heatmap, plot
```

```{julia}
files = list_files("images")
species = map(files) do file
  split(file, "/")[2]
end
imgs = load_web.(files, blur = 2)
As = image_to_array.(imgs)
Xs = image_to_r2.(As, threshold = 0.1);
```

```{julia}
df = DataFrame(File = files, Specie = species, Image = imgs);
grps = groupby(df, :Specie) |> collect;
```

```{julia}
#| output: asis
#| echo: false

# for d ∈ groupby(df, :Specie)
#   print("### $(d.Specie[1]) \n")
#   mosaicview(d.Image, ncol = 3) |> display
# end;
```


```{julia}
for i ∈ [1, 6]
  plot(
    heatmap(As[i]),
    plot_scatter(Xs[i])
  ) |> display
end;
```
